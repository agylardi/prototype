(function(a){a.fn.FlexSaveCalc=function(t){function e(){p.each(function(){if(a(this).attr("multiple")){var t=a(this).find(":selected"),e=0;""!=t&&t.each(function(){e+=a(this).data("price")}),a(this).attr("data-total",e)}else{var l=a(this).find(":selected");a(this).attr("data-total",l.data("price"))}}),w.each(function(){if(a(this).attr("multiple")){var t=a(this).find(":selected"),e=0;""!=t&&t.each(function(){e+=a(this).data("price")}),a(this).attr("data-total",e)}else{var l=a(this).find(":selected");a(this).attr("data-total",l.data("price"))}}),b.find("input[type=text]").each(function(){if(a(this).attr("data-price")||a(this).attr("data-mult")){var t=a(this).val();if(a.isNumeric(t))var e=parseFloat(t);else if(""!=t){alert("Please enter a valid number");e=1}else e=1;var l=parseFloat(a(this).data("mult"))||0,s=parseFloat(a(this).data("price"))||0;a(this).data("prcnt");if(a.isNumeric(s)&&0!=s){var i=s*e;a(this).attr("data-total",i)}l&&0!=l&&a("#flexsave-base-total label").attr("data-mult",e)}}),b.find("input[type=checkbox]").each(function(){if(a(this).is(":checked")){var t=a(this).val();a.isNumeric(t)?a(this).attr("data-total",t):a(this).attr("data-total",0)}else a(this).attr("data-total",0)}),b.find("input[type=radio]").each(function(){if(a(this).is(":checked")){var t=a(this).val();a.isNumeric(t)?a(this).attr("data-total",t):a(this).attr("data-total",0)}else a(this).attr("data-total",0)}),b.find("input[type=hidden]").each(function(){if(a(this).attr("data-price")){var t=a(this).attr("data-price");a.isNumeric(t)&&0!=t&&a(this).attr("data-total",t)}}),l(),P.find("input[type=text]").each(function(){if(a(this).attr("data-price")||a(this).attr("data-mult")){var t=a(this).val();if(a.isNumeric(t))var e=parseFloat(t);else if(""!=t){alert("Please enter a valid number");e=1}else e=1;var l=parseFloat(a(this).data("mult"))||0,s=parseFloat(a(this).data("price"))||0;a(this).data("prcnt");if(a.isNumeric(s)&&0!=s){var i=s*e;a(this).attr("data-total",i)}l&&0!=l&&a("#flexsave-base-total label").attr("data-mult",e)}}),P.find("input[type=checkbox]").each(function(){if(a(this).is(":checked")){var t=a(this).val();a.isNumeric(t)?a(this).attr("data-total",t):a(this).attr("data-total",0)}else a(this).attr("data-total",0)}),P.find("input[type=radio]").each(function(){if(a(this).is(":checked")){var t=a(this).val();a.isNumeric(t)?a(this).attr("data-total",t):a(this).attr("data-total",0)}else a(this).attr("data-total",0)}),P.find("input[type=hidden]").each(function(){if(a(this).attr("data-price")){var t=a(this).attr("data-price");a.isNumeric(t)&&0!=t&&a(this).attr("data-total",t)}}),c()}function l(){switch(v=0,baseTotalMult=a("#flexsave-base-total label").attr("data-mult"),multids=[],b.find("input[data-merge]").each(function(){var t=a(this).data("merge"),e=(t=t.split(","),1);a.each(t,function(t,l){var s=a("#"+l);"checkbox"!=s.attr("type")&&"radio"!=s.attr("type")||!s.is(":checked")?"text"==s.attr("type")?e*=a("#"+l).val():"SELECT"==s.prop("nodeName")&&(e*=a("#"+l).find(":selected").val()):e*=a("#"+l).val()});var l=e;if(a.isNumeric(l)){a(this).val(l);var s=parseFloat(a(this).data("price"))||0,i=s*parseFloat(a(this).val());a(this).attr("data-total",i)}a.isNumeric(l)&&a(this).val(a.number(l,2))}),b.find("[data-mult-ids]").each(function(){var t=a(this).data("mult-ids"),e=(t=t.split(","),0);multids=t,a.each(t,function(t,l){var s=a("#"+l);"checkbox"!=s.attr("type")&&"radio"!=s.attr("type")||!s.is(":checked")?"text"==s.attr("type")?e+=parseFloat(a("#"+l).val()):"SELECT"==s.prop("nodeName")&&(e+=parseFloat(a("#"+l).find(":selected").val())):e+=parseFloat(a("#"+l).val())});var l=e,s=parseFloat(a(this).val());if(a.isNumeric(l)){a.isNumeric(s)?0==s?s=-1:s-=1:s=0;var i=l*s;a(this).attr("data-total",i)}}),u.each(function(){itemCost=a(this).attr("data-total")||0,v+=parseFloat(itemCost)}),baseTotalMult&&(v*=parseFloat(baseTotalMult)),m=v,C=.75*m,g=.5*m,S=.25*m,x=m*h.baseService,F=C*h.baseService,N=g*h.baseService,k=S*h.baseService,selectedProvince=a("#select-province").val(),selectedProvince){case"prairie":case"british":case"atlantic":s(R);break;case"ontario":r(R)}m=m+x+y,C=C+F+T,g=g+N+L,S=S+k+q,a("#flexsave-base-total label.hundred").html(h.currency+a.number(m,2)),a("#flexsave-base-total p:eq(0) span").html(a.number(x,2)),a("#flexsave-base-total p:eq(1) span").html(a.number(y,2)),a("#flexsave-base-total label.three-quarter").html(h.currency+a.number(C,2)),a("#flexsave-base-total p:eq(2) span").html(a.number(F,2)),a("#flexsave-base-total p:eq(3) span").html(a.number(T,2)),a("#flexsave-base-total label.half").html(h.currency+a.number(g,2)),a("#flexsave-base-total p:eq(4) span").html(a.number(N,2)),a("#flexsave-base-total p:eq(5) span").html(a.number(L,2)),a("#flexsave-base-total label.quarter").html(h.currency+a.number(S,2)),a("#flexsave-base-total p:eq(6) span").html(a.number(k,2)),a("#flexsave-base-total p:eq(7) span").html(a.number(q,2)),setTimeout(function(){n(),d()},100)}function s(a){taxList=Object.values(a),y=x*taxList[0],T=F*taxList[0],L=N*taxList[0],q=k*taxList[0]}function r(a){taxList=Object.values(a),y=x*taxList[0],y+=m*taxList[1],y+=(m+x)*taxList[2],T=F*taxList[0],T+=C*taxList[1],T+=(C+F)*taxList[2],L=N*taxList[0],L+=g*taxList[1],L+=(g+N)*taxList[2],q=k*taxList[0],q+=S*taxList[1],q+=(S+k)*taxList[2]}function c(){H=0,addinTotalMult=a("#flexsave-base-total label").attr("data-mult"),multids=[],P.find("input[data-merge]").each(function(){var t=a(this).data("merge"),e=(t=t.split(","),1);a.each(t,function(t,l){var s=a("#"+l);"checkbox"!=s.attr("type")&&"radio"!=s.attr("type")||!s.is(":checked")?"text"==s.attr("type")?e*=a("#"+l).val():"SELECT"==s.prop("nodeName")&&(e*=a("#"+l).find(":selected").val()):e*=a("#"+l).val()});var l=e;if(a.isNumeric(l)){a(this).val(l);var s=parseFloat(a(this).data("price"))||0,i=s*parseFloat(a(this).val());a(this).attr("data-total",i)}a.isNumeric(l)&&a(this).val(a.number(l,2))}),P.find("[data-mult-ids]").each(function(){var t=a(this).data("mult-ids"),e=(t=t.split(","),0);multids=t,a.each(t,function(t,l){var s=a("#"+l);"checkbox"!=s.attr("type")&&"radio"!=s.attr("type")||!s.is(":checked")?"text"==s.attr("type")?e+=parseFloat(a("#"+l).val()):"SELECT"==s.prop("nodeName")&&(e+=parseFloat(a("#"+l).find(":selected").val())):e+=parseFloat(a("#"+l).val())});var l=e,s=parseFloat(a(this).val());if(a.isNumeric(l)){a.isNumeric(s)?0==s?s=-1:s-=1:s=0;var i=l*s;a(this).attr("data-total",i)}}),j.each(function(){itemCost=a(this).attr("data-total")||0,H+=parseFloat(itemCost)}),addinTotalMult&&(H*=parseFloat(addinTotalMult)),M=parseFloat(a("#addin-single").val()),B=parseFloat(a("#addin-couple").val()),E=parseFloat(a("#addin-married").val()),A=M*parseFloat(h.annualSingleRate),H+=A,U=B*parseFloat(h.annualCoupleRate),H+=U,I=E*parseFloat(h.annualMarriedRate),H+=I,H=A+U+I,a("#flexsave-addin label.single").html(h.currency+a.number(A,2)),a("#flexsave-addin label.couple").html(h.currency+a.number(U,2)),a("#flexsave-addin label.married").html(h.currency+a.number(I,2)),a("#flexsave-addin label.total").html(h.currency+a.number(H,2)),setTimeout(function(){n(),d()},100)}function n(){Q=m+H,$=C+H,z=g+H,J=S+H,a("#flexsave-costs label.hundred:eq(0)").html(h.currency+a.number(m,2)),a("#flexsave-costs label.hundred:eq(1)").html(h.currency+a.number(Q,2)),a("#flexsave-costs label.three-quarter:eq(0)").html(h.currency+a.number(C,2)),a("#flexsave-costs label.three-quarter:eq(1)").html(h.currency+a.number($,2)),a("#flexsave-costs label.half:eq(0)").html(h.currency+a.number(g,2)),a("#flexsave-costs label.half:eq(1)").html(h.currency+a.number(z,2)),a("#flexsave-costs label.quarter:eq(0)").html(h.currency+a.number(S,2)),a("#flexsave-costs label.quarter:eq(1)").html(h.currency+a.number(J,2)),a("#flexsave-costs label.addin-total").html(h.currency+a.number(H,2))}function d(){var t=[],e="";a(".flexsave-calc").find("*").each(function(){if(e=a(this).prop("tagName"),"SELECT"==e)if(a(this).attr("multiple")){var l=a(this).find(":selected");""!=l&&l.each(function(){var e=a(this).data("label")||"",l=a(this).data("price");""!=e&&t.push(e+": "+h.currency+l)})}else{var s=a(this).find(":selected");if(""!=s){var i=s.data("label")||"",r=s.data("price");""!=i&&t.push(i+": "+h.currency+r)}}if("INPUT"==e&&"text"==a(this).attr("type")&&(a(this).attr("data-price")||a(this).attr("data-mult")||a(this).attr("data-mult-ids"))){var c=a(this).val();if(a.isNumeric(c))var n=parseFloat(c);else n=1;var d=parseFloat(a(this).data("price"))||0,o=a(this).attr("data-label")||"",b=c;if(""!=o&&""!=b)if(a.isNumeric(d)&&0!=d){var u=d*n;t.push(o+": "+h.currency+u)}else t.push(o+": "+b)}if("INPUT"==e&&"hidden"==a(this).attr("type")&&a(this).attr("data-price")){var p=a(this).attr("data-price");o=a(this).attr("data-label")||"";""!=o&&a.isNumeric(p)&&0!=p&&t.push(o+": "+h.currency+p)}if(("INPUT"==e&&"checkbox"==a(this).attr("type")||"radio"==a(this).attr("type"))&&a(this).is(":checked")){var v=a(this).val();if(a.isNumeric(v)){o=a(this).attr("data-label")||"";var f=v;""!=o&&t.push(o+": "+h.currency+f)}}})}function o(a){return info="",i=0,last=!1,len=Object.keys(a).length,Object.keys(a).forEach(function(a){taxName=a.toString(),taxVal=mapObj[a],last=i===len-1,last?info+=taxName+" ("+100*taxVal+"%)":info+=taxName+" ("+100*taxVal+"%), ",i++}),info}var h=a.extend({type:"Base Cost",currency:"$",baseHeader:"Base FlexSave Cost",baseLabel100:"100% ",baseLabel75:"75%",baseLabel50:"50%",baseLabel25:"25%",baseTax:.05,baseService:.1,addinHeader:"In Province and Travel Additional Coverage",singleLabel:"Single",coupleLabel:"Couple",marriedLabel:"Married",annualSingleRate:137.4,annualCoupleRate:262.8,annualMarriedRate:334.8},t);this.baseUpdateTotal=function(){setTimeout(function(){l()},100)},this.addinUpdateTotal=function(){setTimeout(function(){c()},100)},this.setAddins=function(a){setTimeout(function(){addins=a},100)};var b=this.children("#flexsave-base"),u=b.find("*"),p=b.find("select"),v=0;const f=new Map;f.set("Prairie Provinces",{GST:.05}),f.set("British Columbia",{GST:.05}),f.set("Atlantic Provinces",{HST:.15}),f.set("Ontario",{HST:.13,PST:.08,Premium:.02});var m=0,x=0,y=0,C=0,F=0,T=0,g=0,N=0,L=0,S=0,k=0,q=0,R={},O="GST (5%)",P=this.children("#flexsave-addin"),j=P.find("*"),w=P.find("select"),H=0,M=0,B=0,E=0,A=0,U=0,I=0,D=parseFloat(h.annualSingleRate)/12,G=parseFloat(h.annualCoupleRate)/12,V=parseFloat(h.annualMarriedRate)/12,Q=0,$=0,z=0,J=0;return b.addClass("flexsave-calc"),P.addClass("flexsave-calc"),e(),p.change(function(){if(a(this).attr("multiple")){var t=a(this).find(":selected"),e=0;""!=t&&t.each(function(){e+=a(this).data("price")}),a(this).attr("data-total",e)}else{var s=a(this).find(":selected");a(this).data("mult")>=0?a("#flexsave-base-total label").attr("data-mult",s.val()):a(this).attr("data-total",s.data("price"))}l()}),b.find("input[type=text]").change(function(){if(a(this).attr("data-price")||a(this).attr("data-mult")){var t=a(this).val();if(a.isNumeric(t))var e=parseFloat(t);else if(""!=t){alert("Please enter a valid number");e=1}else e=1;var s=parseFloat(a(this).data("mult"))||0,i=parseFloat(a(this).data("price"))||0;a(this).data("prcnt");if(a.isNumeric(i)&&0!=i){var r=i*e;a(this).attr("data-total",r)}s&&0!=s&&a("#flexsave-base-total label").attr("data-mult",e)}l()}),b.find("input[type=checkbox]").change(function(){if(a(this).is(":checked")){var t=a(this).val();a.isNumeric(t)?a(this).attr("data-total",t):a(this).attr("data-total",0)}else a(this).attr("data-total",0);l()}),b.find("input[type=radio]").change(function(){b.children("input[type=radio]").each(function(){if(a(this).is(":checked")){var t=a(this).val();a.isNumeric(t)?a(this).attr("data-total",t):a(this).attr("data-total",0)}else a(this).attr("data-total",0)}),l()}),w.change(function(){if(a(this).attr("multiple")){var t=a(this).find(":selected"),e=0;""!=t&&t.each(function(){e+=a(this).data("price")}),a(this).attr("data-total",e)}else{var l=a(this).find(":selected");a(this).data("mult")>=0?a("#flexsave-base-total label").attr("data-mult",l.val()):a(this).attr("data-total",l.data("price"))}c()}),P.find("input[type=text]").change(function(){if(a(this).attr("data-price")||a(this).attr("data-mult")){var t=a(this).val();if(a.isNumeric(t))var e=parseFloat(t);else if(""!=t){alert("Please enter a valid number");e=1}else e=1;var l=parseFloat(a(this).data("mult"))||0,s=parseFloat(a(this).data("price"))||0;a(this).data("prcnt");if(a.isNumeric(s)&&0!=s){var i=s*e;a(this).attr("data-total",i)}l&&0!=l&&a("#flexsave-base-total label").attr("data-mult",e)}c()}),P.find("input[type=checkbox]").change(function(){if(a(this).is(":checked")){var t=a(this).val();a.isNumeric(t)?a(this).attr("data-total",t):a(this).attr("data-total",0)}else a(this).attr("data-total",0);c()}),P.find("input[type=radio]").change(function(){b.children("input[type=radio]").each(function(){if(a(this).is(":checked")){var t=a(this).val();a.isNumeric(t)?a(this).attr("data-total",t):a(this).attr("data-total",0)}else a(this).attr("data-total",0)}),c()}),baseDetail=a("#flexsave-base"),baseDetail.append('<div class="flexsave-detail"><section id="flexsave-base-total"><div class="flexsave-detail-header"><h2>Base FlexSave Costs</h2><span>Usage Includes Tax & Fees</span></div><div class="flexsave-detail-header"><label for="select-province">Select your province</label><select name="province" id="select-province"><option value="prairie">Alberta, Manitoba, Saskatchewan</option><option value="british">British Columbia</option><option value="atlantic">Atlantic Province</option><option value="ontario">Ontario</option></select></div><hr><table id="baseTableBody" class="flexsaveTable"><thead><tr class="tableRow"><th scope="col" class="tableHead">Usage</th><th scope="col" class="tableHead">Base Cost</th><th scope="col" class="tableHead">Fee<br><span>Service ('+a.number(100*h.baseService,0)+'%)<span></th><th scope="col" class="tableHead">Tax<br><span>'+O+'</span></th></tr></thead><tbody><tr class="tableRow"><td class="tableCell"><h3>'+h.baseLabel100+'</h3></td><td class="tableCell"><label class="hundred">'+h.currency+a.number(m,2)+'</label></td><td class="tableCell"><p>'+h.currency+"<span>"+a.number(x,2)+'</span></p></td><td class="tableCell"><p>'+h.currency+"<span>"+a.number(y,2)+'</span></p></td></tr><tr class="tableRow"><td class="tableCell"><h3>'+h.baseLabel75+'</h3></td><td class="tableCell"><label class="three-quarter">'+h.currency+a.number(C,2)+'</label></td><td class="tableCell"><p>'+h.currency+"<span>"+a.number(F,2)+'</span></p></td><td class="tableCell"><p>'+h.currency+"<span>"+a.number(T,2)+'</span></p></td></tr><tr class="tableRow"><td class="tableCell"><h3>'+h.baseLabel50+'</h3></td><td class="tableCell"><label class="half">'+h.currency+a.number(g,2)+'</label></td><td class="tableCell"><p>'+h.currency+"<span>"+a.number(N,2)+'</span></p></td><td class="tableCell"><p>'+h.currency+"<span>"+a.number(L,2)+'</span></p></td></tr><tr class="tableRow"><td class="tableCell"><h3>'+h.baseLabel25+'</h3></td><td class="tableCell"><label class="quarter">'+h.currency+a.number(S,2)+'</label></td><td class="tableCell"><p>'+h.currency+"<span>"+a.number(k,2)+'</span></p></td><td class="tableCell"><p>'+h.currency+"<span>"+a.number(q,2)+"</span></p></td></tr></tbody></table></section></div>"),addinDetail=a("#flexsave-addin"),addinDetail.append('<div class="flexsave-detail"><section id="flexsave-addins-total"><div class="flexsave-detail-header"><h2>In Province and Travel Additional Coverage</h2></div><hr><table id="addinsTableBody" class="flexsaveTable"><thead><tr class="tableRow"><th class="tableHead">Coverage</th><th class="tableHead">Monthly</th><th class="tableHead">Annual Rates</th><th class="tableHead">Coverage Total</th></tr></thead><tbody><tr class="tableRow"><td class="tableCell"><h3>Single</h3></td><td class="tableCell"><span>'+h.currency+a.number(D,2)+'</span></td><td class="tableCell"><p>'+h.currency+"<span>"+a.number(h.annualSingleRate,2)+'</span></p></td><td class="tableCell"><label class="single">'+h.currency+a.number(A,2)+'</label></td></tr><tr class="tableRow"><td class="tableCell"><h3>Couple</h3></td><td class="tableCell"><span>'+h.currency+a.number(G,2)+'</span></td><td class="tableCell"><p>'+h.currency+"<span>"+a.number(h.annualCoupleRate,2)+'</span></p></td><td class="tableCell"><label class="couple">'+h.currency+a.number(U,2)+'</label></td></tr><tr class="tableRow"><td class="tableCell"><h3>Married</h3></td><td class="tableCell"><span>'+h.currency+a.number(V,2)+'</span></td><td class="tableCell"><p>'+h.currency+"<span>"+a.number(h.annualMarriedRate,2)+'</span></p></td><td class="tableCell"><label class="married">'+h.currency+a.number(I,2)+'</label></td></tr><tr class="tableRow"><td class="tableCell" colspan="3"><h3>Total Additional Coverage</h3></td><td class="tableCell" colspan="1"><label class="total">'+h.currency+a.number(H,2)+"</label></td></tr></tbody></table></section></div>"),costsDetail=a("#flexsave-addin"),costsDetail.append('<div class="flexsave-detail"><section id="flexsave-costs"><div class="flexsave-detail-header"><h2>Total FlexSave Costs & Stop Loss</h2><span>Including Tax & Fees</span></div><hr><table id="costTableBody" class="flexsaveTable"><thead><tr class="tableRow"><th scope="col" class="tableHead">Usage</th><th scope="col" class="tableHead">Base Cost</th><th scope="col" class="tableHead">Additional<br>Coverage<th scope="col" class="tableHead">FlexSave Cost & <br>Stop Loss</th></tr></thead><tbody><tr class="tableRow"><td class="tableCell"><h3>'+h.baseLabel100+'</h3></td><td class="tableCell"><label class="hundred">'+h.currency+a.number(m,2)+'</label></td><td class="tableCell"><label class="addin-total">'+h.currency+a.number(H,2)+'</label></td><td class="tableCell"><label class="hundred">'+h.currency+"<span>"+a.number(Q,2)+'</span></label></td></tr><tr class="tableRow"><td class="tableCell"><h3>'+h.baseLabel75+'</h3></td><td class="tableCell"><label class="three-quarter">'+h.currency+a.number(C,2)+'</label></td><td class="tableCell"><label class="addin-total">'+h.currency+a.number(H,2)+'</label></td><td class="tableCell"><label class="three-quarter">'+h.currency+"<span>"+a.number($,2)+'</span></label></td></tr><tr class="tableRow"><td class="tableCell"><h3>'+h.baseLabel50+'</h3></td><td class="tableCell"><label class="half">'+h.currency+a.number(g,2)+'</label></td><td class="tableCell"><label class="addin-total">'+h.currency+a.number(H,2)+'</label></td><td class="tableCell"><label class="half">'+h.currency+"<span>"+a.number(z,2)+'</span></label></td></tr><tr class="tableRow"><td class="tableCell"><h3>'+h.baseLabel25+'</h3></td><td class="tableCell"><label class="quarter">'+h.currency+a.number(S,2)+'</label></td><td class="tableCell"><label class="addin-total">'+h.currency+a.number(H,2)+'</label></td><td class="tableCell"><label class="quarter">'+h.currency+"<span>"+a.number(J,2)+"</span></label></td></tr></tbody></table></section></div>"),R=f.get("Prairie Provinces"),a("#select-province").change(function(){var t=a(this).val();switch(mapObj=new Object,t){case"prairie":mapObj=f.get("Prairie Provinces"),O=o(mapObj),R=mapObj;break;case"atlantic":mapObj=f.get("Atlantic Provinces"),O=o(mapObj),R=mapObj;break;case"british":mapObj=f.get("British Columbia"),O=o(mapObj),R=mapObj;break;case"ontario":mapObj=f.get("Ontario"),O=o(mapObj),R=mapObj}a("#baseTableBody > thead > tr > th:nth-child(4) > span").html(O),l()}),this}})(jQuery);